# Problem #318

> This problem was asked by Apple.
>
> You are going on a road trip, and would like to create a suitable music playlist. The trip will require N songs, though you only have *M* songs downloaded, where *M < N*. A valid playlist should select each song at least once, and guarantee a buffer of *B* songs between repeats.
> 
> Given *N, M*, and *B*, determine the number of valid playlists.


```python
import random

def buffer_exists(b, _playlist, song_id):
    if len(_playlist) < 2:
        return True
    for i in range(2, b + 2):
        if i > len(_playlist):
            return True
        if _playlist[-i] == song_id:
            return False
    return True
```


```python
buffer_exists(2, [1, 2, 0, 1, 2, 0], 0)
#buffer_exists(3, [1, 0, 1, 0], 0)
#buffer_exists(3, [1, 2, 0, 1, 2, 0], 0)
```




    True




```python
def f(valid, explored, songs, prefix, target_len, min_buffer):
    for song_id in songs:
        playlist = [_song_id for _song_id in prefix] + [song_id]
        if buffer_exists(min_buffer, playlist, song_id):
            if len(playlist) < target_len:
                valid, explored = f(valid, explored, songs, playlist, target_len, min_buffer)
            else:
                if random.random() < 0.0001:
                    print(valid, explored, playlist)
                valid += 1
                explored += 1
        else:
            explored += 1
    return valid, explored
```


```python

m = 10
n = 25
b = 9

songs = list(range(m))
print(f(0, 0, songs, [], n, b))

```

    16960 2551958 [0, 1, 5, 4, 7, 3, 8, 9, 2, 6, 0, 1, 5, 4, 7, 3, 8, 9, 2, 6, 0, 1, 5, 4, 7]
    20638 3105358 [0, 1, 6, 2, 7, 9, 8, 5, 3, 4, 0, 1, 6, 2, 7, 9, 8, 5, 3, 4, 0, 1, 6, 2, 7]
    25300 3806833 [0, 1, 7, 2, 3, 9, 4, 8, 5, 6, 0, 1, 7, 2, 3, 9, 4, 8, 5, 6, 0, 1, 7, 2, 3]
    37962 5712016 [0, 1, 9, 5, 7, 3, 8, 2, 4, 6, 0, 1, 9, 5, 7, 3, 8, 2, 4, 6, 0, 1, 9, 5, 7]
    40514 6096008 [0, 2, 1, 3, 5, 8, 4, 7, 6, 9, 0, 2, 1, 3, 5, 8, 4, 7, 6, 9, 0, 2, 1, 3, 5]
    64784 9747772 [0, 2, 6, 8, 9, 7, 3, 4, 1, 5, 0, 2, 6, 8, 9, 7, 3, 4, 1, 5, 0, 2, 6, 8, 9]
    98474 14816929 [0, 3, 5, 6, 8, 7, 1, 4, 2, 9, 0, 3, 5, 6, 8, 7, 1, 4, 2, 9, 0, 3, 5, 6, 8]
    105943 15940741 [0, 3, 7, 1, 2, 9, 5, 4, 8, 6, 0, 3, 7, 1, 2, 9, 5, 4, 8, 6, 0, 3, 7, 1, 2]
    112813 16974436 [0, 3, 8, 4, 7, 1, 6, 2, 9, 5, 0, 3, 8, 4, 7, 1, 6, 2, 9, 5, 0, 3, 8, 4, 7]
    128831 19384563 [0, 4, 2, 6, 9, 5, 8, 7, 3, 1, 0, 4, 2, 6, 9, 5, 8, 7, 3, 1, 0, 4, 2, 6, 9]
    134662 20261932 [0, 4, 3, 8, 1, 2, 9, 7, 5, 6, 0, 4, 3, 8, 1, 2, 9, 7, 5, 6, 0, 4, 3, 8, 1]
    137498 20688653 [0, 4, 5, 2, 9, 8, 1, 6, 3, 7, 0, 4, 5, 2, 9, 8, 1, 6, 3, 7, 0, 4, 5, 2, 9]
    146637 22063734 [0, 4, 7, 1, 6, 9, 8, 3, 5, 2, 0, 4, 7, 1, 6, 9, 8, 3, 5, 2, 0, 4, 7, 1, 6]
    159449 23991484 [0, 4, 9, 6, 3, 7, 5, 8, 2, 1, 0, 4, 9, 6, 3, 7, 5, 8, 2, 1, 0, 4, 9, 6, 3]
    161358 24278744 [0, 5, 1, 2, 3, 8, 6, 4, 7, 9, 0, 5, 1, 2, 3, 8, 6, 4, 7, 9, 0, 5, 1, 2, 3]
    166557 25060989 [0, 5, 2, 1, 4, 9, 8, 6, 7, 3, 0, 5, 2, 1, 4, 9, 8, 6, 7, 3, 0, 5, 2, 1, 4]
    174712 26288031 [0, 5, 3, 7, 6, 9, 4, 8, 1, 2, 0, 5, 3, 7, 6, 9, 4, 8, 1, 2, 0, 5, 3, 7, 6]
    181643 27330900 [0, 5, 6, 1, 3, 8, 4, 9, 7, 2, 0, 5, 6, 1, 3, 8, 4, 9, 7, 2, 0, 5, 6, 1, 3]
    191870 28869705 [0, 5, 8, 1, 4, 9, 6, 3, 2, 7, 0, 5, 8, 1, 4, 9, 6, 3, 2, 7, 0, 5, 8, 1, 4]
    193651 29137678 [0, 5, 8, 3, 9, 6, 7, 1, 4, 2, 0, 5, 8, 3, 9, 6, 7, 1, 4, 2, 0, 5, 8, 3, 9]
    206635 31091307 [0, 6, 1, 9, 8, 7, 5, 2, 4, 3, 0, 6, 1, 9, 8, 7, 5, 2, 4, 3, 0, 6, 1, 9, 8]
    222723 33511994 [0, 6, 5, 2, 4, 1, 3, 8, 9, 7, 0, 6, 5, 2, 4, 1, 3, 8, 9, 7, 0, 6, 5, 2, 4]
    232072 34918677 [0, 6, 8, 1, 3, 9, 5, 7, 2, 4, 0, 6, 8, 1, 3, 9, 5, 7, 2, 4, 0, 6, 8, 1, 3]
    234322 35257224 [0, 6, 8, 4, 3, 7, 2, 9, 1, 5, 0, 6, 8, 4, 3, 7, 2, 9, 1, 5, 0, 6, 8, 4, 3]
    302843 45567200 [0, 8, 5, 1, 6, 7, 3, 9, 4, 2, 0, 8, 5, 1, 6, 7, 3, 9, 4, 2, 0, 8, 5, 1, 6]
    312330 46994662 [0, 8, 6, 9, 5, 4, 7, 1, 2, 3, 0, 8, 6, 9, 5, 4, 7, 1, 2, 3, 0, 8, 6, 9, 5]
    313892 47229686 [0, 8, 7, 2, 9, 5, 6, 3, 1, 4, 0, 8, 7, 2, 9, 5, 6, 3, 1, 4, 0, 8, 7, 2, 9]
    319545 48080258 [0, 8, 9, 3, 6, 7, 2, 4, 5, 1, 0, 8, 9, 3, 6, 7, 2, 4, 5, 1, 0, 8, 9, 3, 6]
    324605 48841618 [0, 9, 1, 4, 8, 2, 3, 7, 6, 5, 0, 9, 1, 4, 8, 2, 3, 7, 6, 5, 0, 9, 1, 4, 8]
    339364 51062331 [0, 9, 4, 3, 5, 1, 2, 8, 6, 7, 0, 9, 4, 3, 5, 1, 2, 8, 6, 7, 0, 9, 4, 3, 5]
    340163 51182535 [0, 9, 4, 5, 3, 7, 2, 8, 6, 1, 0, 9, 4, 5, 3, 7, 2, 8, 6, 1, 0, 9, 4, 5, 3]
    356051 53573119 [0, 9, 7, 5, 4, 1, 3, 8, 6, 2, 0, 9, 7, 5, 4, 1, 3, 8, 6, 2, 0, 9, 7, 5, 4]
    356657 53664298 [0, 9, 7, 6, 3, 1, 5, 8, 4, 2, 0, 9, 7, 6, 3, 1, 5, 8, 4, 2, 0, 9, 7, 6, 3]
    358096 53880826 [0, 9, 8, 1, 4, 2, 6, 7, 3, 5, 0, 9, 8, 1, 4, 2, 6, 7, 3, 5, 0, 9, 8, 1, 4]
    375420 56487481 [1, 0, 4, 6, 5, 7, 8, 2, 3, 9, 1, 0, 4, 6, 5, 7, 8, 2, 3, 9, 1, 0, 4, 6, 5]
    378579 56962789 [1, 0, 5, 2, 8, 9, 3, 6, 7, 4, 1, 0, 5, 2, 8, 9, 3, 6, 7, 4, 1, 0, 5, 2, 8]
    380147 57198709 [1, 0, 5, 4, 9, 8, 3, 7, 6, 2, 1, 0, 5, 4, 9, 8, 3, 7, 6, 2, 1, 0, 5, 4, 9]
    384136 57798926 [1, 0, 6, 3, 7, 2, 8, 9, 4, 5, 1, 0, 6, 3, 7, 2, 8, 9, 4, 5, 1, 0, 6, 3, 7]
    391809 58953439 [1, 0, 7, 8, 3, 2, 5, 6, 9, 4, 1, 0, 7, 8, 3, 2, 5, 6, 9, 4, 1, 0, 7, 8, 3]
    393568 59218100 [1, 0, 8, 2, 6, 7, 5, 9, 3, 4, 1, 0, 8, 2, 6, 7, 5, 9, 3, 4, 1, 0, 8, 2, 6]
    408256 61428133 [1, 2, 3, 0, 4, 5, 8, 9, 6, 7, 1, 2, 3, 0, 4, 5, 8, 9, 6, 7, 1, 2, 3, 0, 4]
    411591 61929919 [1, 2, 3, 7, 6, 9, 5, 4, 8, 0, 1, 2, 3, 7, 6, 9, 5, 4, 8, 0, 1, 2, 3, 7, 6]
    426909 64234735 [1, 2, 6, 7, 9, 4, 8, 3, 5, 0, 1, 2, 6, 7, 9, 4, 8, 3, 5, 0, 1, 2, 6, 7, 9]
    430792 64818990 [1, 2, 7, 5, 3, 9, 6, 8, 0, 4, 1, 2, 7, 5, 3, 9, 6, 8, 0, 4, 1, 2, 7, 5, 3]
    435067 65462229 [1, 2, 8, 4, 3, 6, 9, 0, 7, 5, 1, 2, 8, 4, 3, 6, 9, 0, 7, 5, 1, 2, 8, 4, 3]
    440666 66304691 [1, 2, 9, 5, 0, 4, 3, 7, 6, 8, 1, 2, 9, 5, 0, 4, 3, 7, 6, 8, 1, 2, 9, 5, 0]
    443509 66732444 [1, 2, 9, 8, 7, 6, 4, 0, 5, 3, 1, 2, 9, 8, 7, 6, 4, 0, 5, 3, 1, 2, 9, 8, 7]
    453609 68252149 [1, 3, 4, 0, 2, 5, 7, 8, 9, 6, 1, 3, 4, 0, 2, 5, 7, 8, 9, 6, 1, 3, 4, 0, 2]
    460830 69338661 [1, 3, 5, 6, 0, 4, 7, 2, 8, 9, 1, 3, 5, 6, 0, 4, 7, 2, 8, 9, 1, 3, 5, 6, 0]
    468702 70523109 [1, 3, 6, 9, 8, 7, 2, 0, 4, 5, 1, 3, 6, 9, 8, 7, 2, 0, 4, 5, 1, 3, 6, 9, 8]
    469068 70578178 [1, 3, 7, 0, 5, 9, 6, 2, 4, 8, 1, 3, 7, 0, 5, 9, 6, 2, 4, 8, 1, 3, 7, 0, 5]
    475960 71615177 [1, 3, 8, 5, 0, 4, 7, 9, 2, 6, 1, 3, 8, 5, 0, 4, 7, 9, 2, 6, 1, 3, 8, 5, 0]
    479214 72104797 [1, 3, 9, 0, 6, 5, 4, 2, 7, 8, 1, 3, 9, 0, 6, 5, 4, 2, 7, 8, 1, 3, 9, 0, 6]
    482146 72545946 [1, 3, 9, 6, 5, 8, 2, 7, 0, 4, 1, 3, 9, 6, 5, 8, 2, 7, 0, 4, 1, 3, 9, 6, 5]
    490723 73836487 [1, 4, 2, 5, 7, 3, 9, 0, 8, 6, 1, 4, 2, 5, 7, 3, 9, 0, 8, 6, 1, 4, 2, 5, 7]
    497683 74883717 [1, 4, 3, 8, 2, 5, 9, 0, 7, 6, 1, 4, 3, 8, 2, 5, 9, 0, 7, 6, 1, 4, 3, 8, 2]
    500927 75371817 [1, 4, 5, 3, 8, 2, 9, 7, 6, 0, 1, 4, 5, 3, 8, 2, 9, 7, 6, 0, 1, 4, 5, 3, 8]
    500967 75377838 [1, 4, 5, 3, 8, 7, 6, 2, 9, 0, 1, 4, 5, 3, 8, 7, 6, 2, 9, 0, 1, 4, 5, 3, 8]
    512307 77084114 [1, 4, 7, 6, 5, 2, 0, 8, 9, 3, 1, 4, 7, 6, 5, 2, 0, 8, 9, 3, 1, 4, 7, 6, 5]
    514233 77373907 [1, 4, 8, 0, 3, 5, 6, 7, 9, 2, 1, 4, 8, 0, 3, 5, 6, 7, 9, 2, 1, 4, 8, 0, 3]
    521952 78535350 [1, 4, 9, 5, 8, 6, 0, 2, 3, 7, 1, 4, 9, 5, 8, 6, 0, 2, 3, 7, 1, 4, 9, 5, 8]
    524910 78980429 [1, 5, 0, 3, 2, 6, 7, 4, 8, 9, 1, 5, 0, 3, 2, 6, 7, 4, 8, 9, 1, 5, 0, 3, 2]
    526723 79253209 [1, 5, 0, 6, 7, 3, 9, 2, 8, 4, 1, 5, 0, 6, 7, 3, 9, 2, 8, 4, 1, 5, 0, 6, 7]
    539097 81115054 [1, 5, 3, 9, 7, 4, 2, 6, 8, 0, 1, 5, 3, 9, 7, 4, 2, 6, 8, 0, 1, 5, 3, 9, 7]
    541658 81500400 [1, 5, 4, 6, 2, 9, 0, 7, 3, 8, 1, 5, 4, 6, 2, 9, 0, 7, 3, 8, 1, 5, 4, 6, 2]
    599714 90235768 [1, 6, 8, 9, 7, 4, 0, 3, 2, 5, 1, 6, 8, 9, 7, 4, 0, 3, 2, 5, 1, 6, 8, 9, 7]
    637326 95895049 [1, 7, 8, 4, 2, 0, 5, 3, 6, 9, 1, 7, 8, 4, 2, 0, 5, 3, 6, 9, 1, 7, 8, 4, 2]
    648598 97591063 [1, 8, 0, 6, 7, 9, 5, 4, 2, 3, 1, 8, 0, 6, 7, 9, 5, 4, 2, 3, 1, 8, 0, 6, 7]
    653024 98257030 [1, 8, 2, 5, 9, 7, 3, 4, 0, 6, 1, 8, 2, 5, 9, 7, 3, 4, 0, 6, 1, 8, 2, 5, 9]
    682440 102683107 [1, 8, 9, 3, 7, 0, 2, 4, 5, 6, 1, 8, 9, 3, 7, 0, 2, 4, 5, 6, 1, 8, 9, 3, 7]
    689357 103723851 [1, 9, 0, 7, 4, 6, 2, 8, 5, 3, 1, 9, 0, 7, 4, 6, 2, 8, 5, 3, 1, 9, 0, 7, 4]
    694895 104557115 [1, 9, 2, 8, 0, 6, 7, 5, 4, 3, 1, 9, 2, 8, 0, 6, 7, 5, 4, 3, 1, 9, 2, 8, 0]
    708359 106582967 [1, 9, 5, 4, 7, 8, 6, 3, 2, 0, 1, 9, 5, 4, 7, 8, 6, 3, 2, 0, 1, 9, 5, 4, 7]
    708764 106643922 [1, 9, 5, 6, 3, 2, 8, 4, 0, 7, 1, 9, 5, 6, 3, 2, 8, 4, 0, 7, 1, 9, 5, 6, 3]
    711505 107056353 [1, 9, 6, 2, 3, 4, 0, 5, 8, 7, 1, 9, 6, 2, 3, 4, 0, 5, 8, 7, 1, 9, 6, 2, 3]
    718835 108159244 [1, 9, 7, 5, 3, 2, 4, 8, 6, 0, 1, 9, 7, 5, 3, 2, 4, 8, 6, 0, 1, 9, 7, 5, 3]
    732408 110201522 [2, 0, 3, 5, 4, 7, 1, 6, 8, 9, 2, 0, 3, 5, 4, 7, 1, 6, 8, 9, 2, 0, 3, 5, 4]
    745785 112214264 [2, 0, 5, 9, 7, 8, 3, 4, 6, 1, 2, 0, 5, 9, 7, 8, 3, 4, 6, 1, 2, 0, 5, 9, 7]
    752480 113221634 [2, 0, 7, 4, 1, 8, 5, 6, 3, 9, 2, 0, 7, 4, 1, 8, 5, 6, 3, 9, 2, 0, 7, 4, 1]
    763265 114844382 [2, 0, 9, 5, 1, 6, 7, 8, 4, 3, 2, 0, 9, 5, 1, 6, 7, 8, 4, 3, 2, 0, 9, 5, 1]
    770816 115980552 [2, 1, 0, 9, 6, 5, 4, 7, 3, 8, 2, 1, 0, 9, 6, 5, 4, 7, 3, 8, 2, 1, 0, 9, 6]
    778214 117093693 [2, 1, 4, 5, 9, 0, 7, 6, 3, 8, 2, 1, 4, 5, 9, 0, 7, 6, 3, 8, 2, 1, 4, 5, 9]
    797928 120059955 [2, 1, 8, 4, 3, 6, 0, 5, 7, 9, 2, 1, 8, 4, 3, 6, 0, 5, 7, 9, 2, 1, 8, 4, 3]
    800644 120468611 [2, 1, 8, 9, 0, 3, 4, 7, 5, 6, 2, 1, 8, 9, 0, 3, 4, 7, 5, 6, 2, 1, 8, 9, 0]
    813285 122370624 [2, 3, 1, 5, 7, 4, 9, 6, 8, 0, 2, 3, 1, 5, 7, 4, 9, 6, 8, 0, 2, 3, 1, 5, 7]
    815277 122670342 [2, 3, 1, 8, 4, 9, 7, 5, 6, 0, 2, 3, 1, 8, 4, 9, 7, 5, 6, 0, 2, 3, 1, 8, 4]
    829208 124766484 [2, 3, 6, 5, 8, 0, 4, 7, 1, 9, 2, 3, 6, 5, 8, 0, 4, 7, 1, 9, 2, 3, 6, 5, 8]
    832547 125268866 [2, 3, 7, 1, 4, 9, 5, 8, 6, 0, 2, 3, 7, 1, 4, 9, 5, 8, 6, 0, 2, 3, 7, 1, 4]



```python

```
